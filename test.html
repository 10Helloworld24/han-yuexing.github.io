<!DOCTYPE html>
<html>
	<head>
		<title>GitHub Counter</title>
		<meta charset="UTF-8">
	</head>
	<body>
		<h1>Welcome to my website!</h1>
		<p>This page has been visited <span id="counter">0</span> times.</p>
		<script>
			const token = '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'; // 请将YOUR_GITHUB_TOKEN替换为您的GitHub Personal Access Token
			const url = 'https://api.github.com/repos/han-yuexing/han-yuexing.github.io/contents/counter.txt';
			const headers = new Headers();
			headers.append('Authorization', `token ${token}`);
			headers.append('Content-Type', 'application/vnd.github.v3+json');

			fetch(url, {
					headers
				})
				.then(response => response.json())
				.then(data => {
					let counter = parseInt(atob(data.content));
					document.getElementById('counter').textContent = counter;
					counter++;

					fetch(url, {
							method: 'PUT',
							headers,
							body: JSON.stringify({
								message: 'Update counter.txt',
								content: btoa(counter.toString()),
								sha: data.sha
							})
						})
						.then(response => response.json())
						.then(data => console.log(data))
						.catch(error => console.error(error));
				})
				.catch(error => console.error(error));
		</script>
	</body>
</html>
